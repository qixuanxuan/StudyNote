# 重构_改善代码（1-26）

## 重复代码

提取代码段无局部变量，直接提取

提取代码段有局部变量，如果之后还使用则要把变量作为出参

提取代码段有局部变量，如果之前还使用则要把变量作为入参

# 设计模式

## Singleton模式

我们怎样去创建一个唯一的变量（对象）？在基于对象的设计中我们可以通过创建一个全局变量（对象）来实现，在面向对象和面向过程结合的设计范式（如C++中）中，我们也还是可以通过一个全局变量实现这一点。但是当我们遇到了纯粹的面向对象范式中，这一点可能就只能是通过Singleton模式来实现了，可能这也正是很多公司在招聘Java开发人员时候经常考察Singleton模式的缘故吧。

```c++
#include <unordered_map>
#include <mutex>
#include <iostream>
#include <stack>
using namespace std;
class singleEx
{
private:
	static singleEx * m_instance;
	static std::mutex m_mutex;
public:
	singleEx* getInstance()
	{
		m_mutex.lock();
		if (m_instance == NULL) {
			m_instance = new singleEx();
		}
		m_mutex.unlock();
		return m_instance;
	}
};


int main()
{
	using namespace std;
	// 单例模式
	Singelton * p1 = Singelton::getInstance();
	Singelton * p2 = Singelton::getInstance();
	if (p1 == p2)
		std::cout << "一致" << std::endl;
	else
		std::cout << "不一致" << std::endl;

	getchar();
	return 0;
}
```



